<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Meta Tags PWA -->
    <meta name="theme-color" content="#0f766e"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Sentinela - Controle BÃ©lico">
    <meta name="description" content="Sistema de controle e reserva de armamento da PolÃ­cia Militar">
    <meta name="keywords" content="armamento, policia militar, reserva, controle, bÃ©lico">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ãcones -->
    <link rel="icon" type="image/png" href="icons/favicon-196.png">
    <link rel="apple-touch-icon" href="icons/apple-icon-180.png">
    
    <!-- Splash Screens iOS (reduzido para performance) -->
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2048-2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1668-2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1179-2556.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1284-2778.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1170-2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1125-2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1242-2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-828-1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-750-1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-640-1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">

    <title>Sentinela - Controle BÃ©lico</title>
    
    <!-- CSS e Fontes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              police: {
                50: '#f0fdfa',
                100: '#ccfbf1',
                200: '#99f6e4',
                300: '#5eead4',
                400: '#2dd4bf',
                500: '#14b8a6',
                600: '#0d9488',
                700: '#0f766e',
                800: '#115e59',
                900: '#134e4a',
              }
            }
          }
        }
      }
    </script>
    
    <style>
      body { 
        font-family: 'Inter', sans-serif; 
        -webkit-tap-highlight-color: transparent;
        background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
        min-height: 100vh;
      }
      
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #64748b; }
      
      /* Melhorar experiÃªncia PWA */
      @media (display-mode: standalone) {
        body {
          -webkit-user-select: none;
          -webkit-touch-callout: none;
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }

      /* Loading e fallback */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        flex-direction: column;
        gap: 1rem;
      }

      .pwa-status {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        z-index: 10000;
        backdrop-filter: blur(10px);
      }
    </style>
    
    <script type="importmap">
      {
        "imports": {
          "react": "https://aistudiocdn.com/react@^19.2.0",
          "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
          "react/": "https://aistudiocdn.com/react@^19.2.0/",
          "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
          "recharts": "https://aistudiocdn.com/recharts@^3.4.1",
          "jszip": "https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm"
        }
      }
    </script>
  </head>
  
  <body class="text-slate-100 transition-colors duration-200">
    <!-- Status PWA para debug -->
    <div id="pwa-status" class="pwa-status">
      ðŸ”„ Verificando...
    </div>

    <!-- ConteÃºdo principal -->
    <div id="root">
      <!-- Fallback enquanto o React carrega -->
      <div class="loading">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
        <h1 class="text-2xl font-bold">Sentinela - Controle BÃ©lico</h1>
        <p class="text-white/80">Carregando sistema...</p>
        <div id="fallback-content" class="text-center mt-8 hidden">
          <div class="bg-white/10 backdrop-blur-lg rounded-lg p-6 max-w-md mx-auto">
            <h2 class="text-xl font-semibold mb-4">Sistema de Reserva de Armamento</h2>
            <p class="mb-4">Se esta mensagem permanecer, verifique o console (F12) para erros.</p>
            <button onclick="location.reload()" class="bg-white text-teal-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition">
              Recarregar PÃ¡gina
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Service Worker Registration e PWA Detection -->
    <script>
      // Registrar Service Worker para PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('âœ… Service Worker registrado com sucesso: ', registration.scope);
              updatePWAStatus('Service Worker: âœ… Registrado');
            })
            .catch(function(error) {
              console.log('âŒ Falha ao registrar Service Worker: ', error);
              updatePWAStatus('Service Worker: âŒ Erro - ' + error.message);
            });
        });
      } else {
        updatePWAStatus('Service Worker: âŒ NÃ£o suportado');
      }

      // Detectar e mostrar status do PWA
      function checkPWAStatus() {
        const statusElement = document.getElementById('pwa-status');
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isIOSPWA = window.navigator.standalone;
        
        let status = 'ðŸŒ Navegador';
        let color = '#fbbf24'; // amarelo
        
        if (isStandalone || isIOSPWA) {
          status = 'âœ… PWA Instalado';
          color = '#4ade80'; // verde
          document.body.classList.add('pwa-installed');
        }

        // Verificar se pode ser instalado
        if (!isStandalone && !isIOSPWA) {
          window.addEventListener('beforeinstallprompt', (e) => {
            status = 'ðŸ“¥ Pode Instalar';
            color = '#60a5fa'; // azul
            updatePWAStatus(status, color);
          });
        }

        updatePWAStatus(status, color);
        return status;
      }

      function updatePWAStatus(message, color = '#fbbf24') {
        const element = document.getElementById('pwa-status');
        if (element) {
          element.textContent = message;
          element.style.backgroundColor = color;
        }
        console.log('ðŸ“± Status PWA:', message);
      }

      // Verificar ao carregar e quando a visibilidade muda
      window.addEventListener('DOMContentLoaded', checkPWAStatus);
      document.addEventListener('visibilitychange', checkPWAStatus);

      // Mostrar fallback se o React nÃ£o carregar
      setTimeout(() => {
        if (!window.React) {
          document.getElementById('fallback-content').classList.remove('hidden');
          updatePWAStatus('âš ï¸ React nÃ£o carregou', '#f87171');
        }
      }, 5000);

      // Prevenir zoom em campos de input no iOS
      document.addEventListener('touchstart', function(event) {
        if (event.touches.length > 1) {
          event.preventDefault();
        }
      });

      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);

      // Log inicial
      console.log('ðŸš€ Sentinela PWA - Inicializado');
      console.log('ðŸ“± User Agent:', navigator.userAgent);
    </script>
  </body>
</html>
